# maxoptra_test

Небольшоае тестовое задание для компании Maxoptra.

## ЗАПУСК
Для запуска необходим Linux, Docker и Docker-compose. Все volumes и images создаются с префиксом ibelan_maxoptra_test, чтобы ни с чем не пересекаться.

* Запуск:
  * ./start.sh
* Остановка:
  * ./stop.sh
* Зачистка образов и томов (нужно раскомментировать зачистку образова для build-контейнера, чтобы зачистить и его тоже):
  * ./clean.sh

Сервис приложение будет доступен по адресу http://localhost:8080/app/gps.
Порт можно кастомизировать в файле ".env".

## СТЕК
* Java 11
* Spring Boot 2
* Hibernate
* Jetty
* Postgres 13
* Spatial4j
* Flyway
* Lombok
* Всё завёрнуто в Docker

## ВОПРОСЫ
Постановка вызывает ряд вопросов.

Самый спорный момент заключается во фразе:
> GPS позиций не всегда поступают упорядоченно по времени. Первыми могут прийти координаты от 12.07, а затем координаты от 12.06 и 12.05.

Было бы неплохо знать о характере этой неупорядоченности.
В случае если это перемешивание может происходить в диапазоне 2-3 минут, то можно записывать фактическое время прибытия/отбытия без дальнейших исправлений. Тогда в записях могут возникнуть небольшие неточности, допустимость которых является ещё одним вопросом.

В случае если вышеуказанные неточности недопустимы, или если данные могут приходить вообще абсолютно хаотично (как в файле с примером gps трекинга), то здесь не обойтись без исправления уже записанных прибытий/отбытий или хранения предварительных записей с откладыванием записи финальных значений, скажем, на сутки.

Также, вызывает вопрос фраза:
> Автомобили не всегда соблюдают порядок поставки. Иногда они могут его нарушить и выполнить выгрузки в точках 4,5,6 а затем в 1,2,3.

Кейс:
Автомобиль посетил локацию в час ночи, которую должен был посетить рано утром, а на следующее утро у него снова назначено посещение той же локации. К какому плановому посещению привязывать это фактическое посещение? Возможно, необходимо временное или локационное (стоянка на ночь) разграничение. Но так как и в расписании и в gps-трекинге указаны данные только на один день, то я просто пропущу этот момент.

Также непонятно может ли автомобиль проезжать в радиусе 300м возле некоторой локации, но не посещать её (до её фактического посещения/после её фактического посещения). На практике такое, думаю, более чем возможно.
Можно, например, при сравнении предполагаемых пребываний, фактическими считать те, у которых больше "соседних" по времени трэк-данных (т.е. это значит, что автомобиль стоял).

## РЕАЛИЗАЦИЯ
Итого, с учётом набора допущений, реализовано:
* Хранение приходящих данных трекинга в таблице "gps" (она не зачищается, но по идее её нужно периодически зачищать)
* Вытягивание всех данных по трекингу автомобиля и их повторный анализ
* Запись и исправление данных по фактическому прибытию/отбытию
